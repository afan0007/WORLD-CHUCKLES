<!-- dashboard.html -->
{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="{% static 'js/chart.js' %}"></script>
</head>
<body>
    {% if user %}
        <h1>Welcome to the Dashboard, {{ user.username }}</h1>

        <h2>Real-time Average Status by Country</h2>
        <canvas id="countryStatusChart"></canvas>

        
        <h2>Joke Sensitivity Distribution</h2>
        <canvas id="offensiveStatusChart"></canvas>
        
        <script>
            // Setup the chart
            const ctx = document.getElementById('countryStatusChart').getContext('2d');
            const countryStatusChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [], // Country labels
                    datasets: [{
                        label: 'Average Status',
                        data: [], // Status data
                        backgroundColor: 'skyblue',
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Function to fetch and update the chart data
            function updateChart() {
                fetch('/api/country-status/')
                .then(response => response.json())
                .then(data => {
                    // Update chart labels and data
                    countryStatusChart.data.labels = data.countries;
                    countryStatusChart.data.datasets[0].data = data.avg_statuses;
                    
                    // Re-render the chart with new data
                    countryStatusChart.update();
                });
            }

            // Update the chart every 5 seconds
            setInterval(updateChart, 5000);

            // Initial chart load
            updateChart();

        // Initialize Chart.js
        const ctx1 = document.getElementById('offensiveStatusChart').getContext('2d');
        const chart = new Chart(ctx1, {
            type: 'pie',
            data: {
                labels: [],  // Labels will be updated later
                datasets: [{
                    label: 'Jokes Status',
                    data: [],  // Data will be updated later
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return `${tooltipItem.label}: ${tooltipItem.raw}`;
                            }
                        }
                    }
                }
            }
        });

        function updateChart1() {
            fetch('/api/offensive-status/')
                .then(response => response.json())
                .then(data => {
                    chart.data.labels = data.categories;
                    chart.data.datasets[0].data = data.counts;
                    chart.update();
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // Initial chart update
        updateChart1();

        // Update chart every 30 seconds
        setInterval(updateChart1, 30000);
        </script>


        <!-- Add more dashboard content here -->
    {% else %}
        <h1>You are not logged in</h1>
        <p>Please log in to access the dashboard.</p>
    {% endif %}
</body>
</html>
